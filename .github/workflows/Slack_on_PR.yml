name: Notify Slack on PR and Review Events

on:
  pull_request:
    types: [opened, review_requested]
  pull_request_review:
    types: [submitted]

jobs:
  notify-on-pr:
    runs-on: ubuntu-latest
    steps:
      - name: Notify Slack for PR Event
        if: >
          github.event_name == 'pull_request' &&
          (github.event.action == 'opened' || github.event.action == 'review_requested')
        uses: slackapi/slack-github-action@v2.0.0
        with:
          webhook-type: "incoming-webhook"
          webhook: ${{ secrets.SLACK_WEBHOOK_URL }}
          payload: |
            {
              "attachments": [
                {
                  "title": "*🎁 New Pull Request Created*",
                  "color": "#adff2f",
                  "fields": [
                    {
                      "title": "📑 Title",
                      "value": "${{ github.event.pull_request.title }}",
                      "short": true
                    },
                    {
                      "title": "🧑‍💻 Author",
                      "value": "${{ github.event.pull_request.user.login }}",
                      "short": true
                    },
                    {
                      "title": "🛜 URL",
                      "value": "<${{ github.event.pull_request.html_url }}|View PR>",
                      "short": true
                    }
                  ]
                }
              ]
            }

  notify-on-review:
    runs-on: ubuntu-latest
    steps:
      - name: Notify Slack for PR Review
        if: >
          github.event_name == 'pull_request_review' &&
          github.event.action == 'submitted'
        uses: slackapi/slack-github-action@v2.0.0
        with:
          webhook-type: "incoming-webhook"
          webhook: ${{ secrets.SLACK_WEBHOOK_URL }}
          payload: |
            {
              "attachments": [
                {
                  "title": "*💻 Pull Request Review Submitted*",
                  "color": "${{ github.event.review.state == 'approved' ? '#36a64f' : github.event.review.state == 'changes_requested' ? '#ff0000' : '#cccccc' }}",
                  "fields": [
                    {
                      "title": "📑 PR Title",
                      "value": "${{ github.event.pull_request.title }}",
                      "short": true
                    },
                    {
                      "title": "🧑‍💻 PR Author",
                      "value": "${{ github.event.pull_request.user.login }}",
                      "short": true
                    },
                    {
                      "title": "🧑‍💻 Reviewer",
                      "value": "${{ github.event.review.user.login }}",
                      "short": true
                    },
                    {
                      "title": "🎭 Review Status",
                      "value": "${{ github.event.review.state }}",
                      "short": true
                    },
                    {
                      "title": "🛜 URL",
                      "value": "<${{ github.event.review.html_url }}|View Review>",
                      "short": true
                    }
                  ]
                }
              ]
            }
